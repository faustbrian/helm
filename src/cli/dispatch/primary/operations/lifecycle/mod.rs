use anyhow::Result;

use crate::cli::args::{Cli, Commands};
use crate::cli::handlers;
use crate::config::Config;

mod up;

pub(super) fn dispatch(cli: &Cli, config: &mut Config) -> Option<Result<()>> {
    match &cli.command {
        Commands::Up(args) => Some(up::dispatch_up(
            cli,
            config,
            args.service.as_deref(),
            args.kind,
            args.profile.as_deref(),
            args.healthy,
            args.timeout,
            args.pull,
            args.recreate,
            args.random_ports,
            args.force_random_ports,
            args.port_strategy,
            args.port_seed.as_deref(),
            args.persist_ports,
            args.write_env,
            args.with_project_deps,
            args.with_data,
            args.parallel,
        )),
        Commands::Apply(args) => Some(up::dispatch_up(
            cli,
            config,
            None,
            None,
            None,
            true,
            30,
            crate::cli::args::PullPolicyArg::Missing,
            false,
            false,
            false,
            crate::cli::args::PortStrategyArg::Random,
            None,
            false,
            false,
            args.with_project_deps,
            true,
            1,
        )),
        Commands::Update(args) => Some(handlers::handle_update(
            config,
            args.service.as_deref(),
            args.kind,
            args.profile.as_deref(),
            args.recreate,
            args.no_rebuild_app_image,
            args.healthy,
            args.timeout,
            cli.config.as_deref(),
            cli.project_root.as_deref(),
        )),
        Commands::Down(args) => Some(handlers::handle_down(
            config,
            args.service.as_deref(),
            args.kind,
            args.with_project_deps,
            args.force_project_dep_down,
            args.parallel,
            cli.quiet,
            cli.no_color,
            cli.dry_run,
            cli.env.as_deref(),
            cli.config.as_deref(),
            cli.project_root.as_deref(),
        )),
        Commands::Recreate(args) => Some(handlers::handle_recreate(
            config,
            args.service.as_deref(),
            args.kind,
            args.healthy,
            args.timeout,
            args.random_ports,
            args.persist_ports,
            args.write_env,
            args.parallel,
            cli.quiet,
            cli.env.as_deref(),
            cli.config.as_deref(),
            cli.project_root.as_deref(),
            &cli.config,
            &cli.project_root,
        )),
        Commands::Restart(args) => Some(handlers::handle_restart(
            config,
            args.service.as_deref(),
            args.kind,
            args.healthy,
            args.timeout,
            args.parallel,
        )),
        _ => None,
    }
}
